@page "/"

<PageTitle>Home</PageTitle>

<h1>Blazor Server - Blue-Green Deployment POC</h1>

<div class="alert alert-primary" role="alert">
    <h4 class="alert-heading">🚀 State Persistence for Zero-Downtime Deployments</h4>
    <p>
        This application demonstrates how to use <strong>.NET 10's built-in Blazor state persistence APIs</strong> 
        to persist circuit state during blue-green deployments, ensuring a seamless 
        user experience with no state loss.
    </p>
</div>

<h2>What's New in .NET 10</h2>

<div class="alert alert-warning" role="alert">
    <h5>✨ Built-in State Persistence</h5>
    <p>
        .NET 10 introduces native state persistence APIs that automatically save and restore component state
        during circuit evictions, reconnections, and server restarts. No custom services or JavaScript interop required!
    </p>
    <ul>
        <li><code>PersistentComponentState</code> service - Framework state persistence</li>
        <li><code>RegisterOnPersisting</code> - Hook into state persistence lifecycle</li>
        <li><code>TryTakeFromJson</code> - Restore persisted state on initialization</li>
        <li><code>PersistAsJson</code> - Save state when circuit is evicted</li>
    </ul>
</div>

<h2>How It Works</h2>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">📝 Automatic Persistence</h5>
                <p class="card-text">
                    State registered with <code>RegisterOnPersisting</code> 
                    is automatically saved when the circuit is evicted and restored on reconnection.
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">🔄 Framework-Level Support</h5>
                <p class="card-text">
                    Built directly into the Blazor framework - no custom middleware, 
                    services, or JavaScript required.
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">🎯 Seamless Recovery</h5>
                <p class="card-text">
                    State is automatically restored when users reconnect after 
                    server restarts or circuit evictions.
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">✨ Transparent Updates</h5>
                <p class="card-text">
                    Users experience seamless updates with no data loss or 
                    interruption to their workflow.
                </p>
            </div>
        </div>
    </div>
</div>

<h2>Try It Out</h2>

<ol>
    <li>Navigate to the <a href="/counter">Counter</a> page</li>
    <li>Increment the counter several times</li>
    <li>Restart the application (simulate blue-green deployment)</li>
    <li>Refresh the page - your count will be restored automatically!</li>
</ol>

<div class="alert alert-success" role="alert">
    <strong>Production Ready:</strong> .NET 10's built-in state persistence works out of the box 
    for blue-green deployments. The framework handles serialization, storage, and restoration automatically.
</div>

<h2>Code Example</h2>

<pre><code>@@inject PersistentComponentState ApplicationState
@@implements IDisposable

@@code {
    private int currentCount = 0;
    private PersistingComponentStateSubscription _subscription;
    
    protected override void OnInitialized()
    {
        // Restore state from previous session
        if (ApplicationState.TryTakeFromJson&lt;int&gt;("count", out var restored))
        {
            currentCount = restored;
        }
        
        // Register callback to persist state
        _subscription = ApplicationState.RegisterOnPersisting(PersistState);
    }
    
    private Task PersistState()
    {
        ApplicationState.PersistAsJson("count", currentCount);
        return Task.CompletedTask;
    }
    
    public void Dispose() => _subscription?.Dispose();
}</code></pre>


